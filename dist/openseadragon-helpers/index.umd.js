(function(a,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("openseadragon"),require("@iiif/vault-helpers")):typeof define=="function"&&define.amd?define(["exports","openseadragon","@iiif/vault-helpers"],f):(a=typeof globalThis<"u"?globalThis:a||self,f(a.CloverIIIFOpenseadragonHelpers={},a.OpenSeadragon))})(this,function(a,f){"use strict";let m=window.OpenSeadragon;if(!m&&(m=f,!m))throw new Error("OpenSeadragon is missing.");const g="http://www.w3.org/2000/svg";m.Viewer&&(m.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new _(this),this._svgOverlayInfo)});const _=function(e){const t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(g,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(g,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){t.resize()}),this._viewer.addHandler("open",function(){t.resize()}),this._viewer.addHandler("rotate",function(){t.resize()}),this._viewer.addHandler("flip",function(){t.resize()}),this._viewer.addHandler("resize",function(){t.resize()}),this.resize()};_.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const e=this._viewer.viewport.pixelFromPoint(new m.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),r=this._viewer.viewport.getRotation(),n=this._viewer.viewport.getFlip(),c=this._viewer.viewport._containerInnerSize.x;let s=c*t;const l=s;n&&(s=-s,e.x=-e.x+c),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+s+","+l+") rotate("+r+")")},onClick:function(e,t){new m.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};const k=e=>new _(e),x=e=>{var r,n,c,s,l;let t={id:typeof e=="string"?e:e.source};if(typeof e=="string"){if(e.includes("#xywh=")){const i=e.split("#xywh=");if(i&&i[1]){const[o,h,v,u]=i[1].split(",").map(d=>Number(d));t={id:i[0],rect:{x:o,y:h,w:v,h:u}}}}else if(e.includes("#t=")){const i=e.split("#t=");i&&i[1]&&(t={id:i[0],t:i[1]})}}else if(typeof e=="object"){if(((r=e.selector)==null?void 0:r.type)==="PointSelector")t={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if(((n=e.selector)==null?void 0:n.type)==="SvgSelector")t={id:e.source,svg:e.selector.value};else if(((c=e.selector)==null?void 0:c.type)==="FragmentSelector"&&(s=e.selector)!=null&&s.value.includes("xywh=")&&e.source.type=="Canvas"&&e.source.id){const i=(l=e.selector)==null?void 0:l.value.split("xywh=");if(i&&i[1]){const[o,h,v,u]=i[1].split(",").map(d=>Number(d));t={id:e.source.id,rect:{x:o,y:h,w:v,h:u}}}}}return t},N=e=>{let t,r;if(Array.isArray(e)&&(t=e[0],t)){let n;"@id"in t?n=t["@id"]:n=t.id,r=n}return r};var w=(e=>(e.TiledImage="tiledImage",e.SimpleImage="simpleImage",e))(w||{});function T(e,t,r,n,c){if(!e)return;const s=1/t.width;n.forEach(l=>{if(!l.target)return;const i=x(l.target),{point:o,rect:h,svg:v}=i;if(h){const{x:u,y:d,w:p,h:A}=h;H(e,u*s,d*s,p*s,A*s,r,c)}if(o){const{x:u,y:d}=o,p=`
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
          <circle cx="${u}" cy="${d}" r="20" />
        </svg>
      `;y(e,p,r,s,c)}v&&y(e,v,r,s,c)})}function I(e,t,r){let n,c,s=40,l=40;t.rect&&(n=t.rect.x,c=t.rect.y,s=t.rect.w,l=t.rect.h),t.point&&(n=t.point.x,c=t.point.y);const i=1/e.width;return new f.Rect(n*i-s*i/2*(r-1),c*i-l*i/2*(r-1),s*i*r,l*i*r)}function H(e,t,r,n,c,s,l){const i=new f.Rect(t,r,n,c),o=document.createElement("div");if(s){const{backgroundColor:h,opacity:v,borderType:u,borderColor:d,borderWidth:p}=s;o.style.backgroundColor=h,o.style.opacity=v,o.style.border=`${u} ${p} ${d}`,o.className=l}e.addOverlay(o,i)}function E(e){if(!e)return null;const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children[0]}function y(e,t,r,n,c){const s=E(t);if(s)for(const l of s.children)S(e,l,r,n,c)}function S(e,t,r,n,c){var s;if(t.nodeName==="#text")W(t);else{const l=C(t,r,n),i=k(e);i.node().append(l),(s=i._svg)==null||s.setAttribute("class",c),t.childNodes.forEach(o=>{S(e,o,r,n,c)})}}function C(e,t,r){let n=!1,c=!1,s=!1,l=!1;const i=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName);if(e.attributes.length>0)for(let o=0;o<e.attributes.length;o++){const h=e.attributes[o];switch(h.name){case"fill":s=!0;break;case"stroke":n=!0;break;case"stroke-width":c=!0;break;case"fill-opacity":l=!0;break}i.setAttribute(h.name,h.textContent)}return n||(i.style.stroke=t==null?void 0:t.borderColor),c||(i.style.strokeWidth=t==null?void 0:t.borderWidth),s||(i.style.fill=t==null?void 0:t.backgroundColor),l||(i.style.fillOpacity=t==null?void 0:t.opacity),i.setAttribute("transform",`scale(${r})`),i}function W(e){e.textContent&&(e.textContent.includes(`
`)||console.log("nodeName:",e.nodeName,", textContent:",e.textContent,", childNodes.length",e.childNodes.length))}const b=e=>{const t=Array.isArray(e==null?void 0:e.service)&&(e==null?void 0:e.service.length)>0,r=t?N(e==null?void 0:e.service):e==null?void 0:e.id,n=t?w.TiledImage:w.SimpleImage;return{uri:r,imageType:n}},z=(e,t)=>{const r=t?w.TiledImage:w.SimpleImage;return{uri:e,imageType:r}};function F(e,t){if(!e)return;t.startsWith(".")||(t="."+t);const r=document.querySelectorAll(t);r&&r.forEach(n=>e.removeOverlay(n))}function R(e,t,r,n){const c=x(r),{point:s,rect:l,svg:i}=c;if(s||l||i){const o=I(n,c,t);e==null||e.viewport.fitBounds(o)}}a.addOverlaysToViewer=T,a.addSvgOverlay=y,a.createOpenSeadragonRect=I,a.panToTarget=R,a.parseImageBody=b,a.parseSrc=z,a.removeOverlaysFromViewer=F,a.svg_handleElementNode=C,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
