{"version":3,"file":"index.umd.js","sources":["../../src/lib/openseadragon-svg.ts","../../src/lib/annotation-helpers.ts","../../src/lib/iiif.ts","../../src/types/open-seadragon.ts","../../src/lib/openseadragon-helpers.ts"],"sourcesContent":["// OpenSeadragon SVG Overlay plugin 0.0.5\n// https://github.com/openseadragon/svg-overlay/issues/34#issuecomment-1147992921\nimport OpenSeadragon from \"openseadragon\";\n\nlet $ = window.OpenSeadragon;\n\nif (!$) {\n  $ = OpenSeadragon;\n  if (!$) {\n    throw new Error(\"OpenSeadragon is missing.\");\n  }\n}\n\nconst svgNS = \"http://www.w3.org/2000/svg\";\n\n// ----------\nif ($.Viewer) {\n  // @ts-expect-error: svgOverlay does not exist on Viewer\n  $.Viewer.prototype.svgOverlay = function () {\n    if (this._svgOverlayInfo) {\n      return this._svgOverlayInfo;\n    }\n\n    this._svgOverlayInfo = new Overlay(this);\n    return this._svgOverlayInfo;\n  };\n}\n// ----------\nconst Overlay = function (viewer) {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const self = this;\n\n  this._viewer = viewer;\n  this._containerWidth = 0;\n  this._containerHeight = 0;\n\n  this._svg = document.createElementNS(svgNS, \"svg\");\n  this._svg.style.position = \"absolute\";\n  this._svg.style.left = 0;\n  this._svg.style.top = 0;\n  this._svg.style.width = \"100%\";\n  this._svg.style.height = \"100%\";\n  this._viewer.canvas.appendChild(this._svg);\n\n  this._node = document.createElementNS(svgNS, \"g\");\n  this._svg.appendChild(this._node);\n\n  this._viewer.addHandler(\"animation\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"open\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"rotate\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"flip\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"resize\", function () {\n    self.resize();\n  });\n\n  this.resize();\n};\n\n// ----------\nOverlay.prototype = {\n  // ----------\n  node: function () {\n    return this._node;\n  },\n\n  // ----------\n  resize: function () {\n    if (this._containerWidth !== this._viewer.container.clientWidth) {\n      this._containerWidth = this._viewer.container.clientWidth;\n      this._svg.setAttribute(\"width\", this._containerWidth);\n    }\n\n    if (this._containerHeight !== this._viewer.container.clientHeight) {\n      this._containerHeight = this._viewer.container.clientHeight;\n      this._svg.setAttribute(\"height\", this._containerHeight);\n    }\n\n    const p = this._viewer.viewport.pixelFromPoint(new $.Point(0, 0), true);\n    const zoom = this._viewer.viewport.getZoom(true);\n    const rotation = this._viewer.viewport.getRotation();\n    const flipped = this._viewer.viewport.getFlip();\n    // TODO: Expose an accessor for _containerInnerSize in the OSD API so we don't have to use the private variable.\n    const containerSizeX = this._viewer.viewport._containerInnerSize.x;\n    let scaleX = containerSizeX * zoom;\n    const scaleY = scaleX;\n\n    if (flipped) {\n      // Makes the x component of the scale negative to flip the svg\n      scaleX = -scaleX;\n      // Translates svg back into the correct coordinates when the x scale is made negative.\n      p.x = -p.x + containerSizeX;\n    }\n\n    this._node.setAttribute(\n      \"transform\",\n      \"translate(\" +\n        p.x +\n        \",\" +\n        p.y +\n        \") scale(\" +\n        scaleX +\n        \",\" +\n        scaleY +\n        \") rotate(\" +\n        rotation +\n        \")\",\n    );\n  },\n  // ----------\n  onClick: function (node, handler) {\n    // TODO: Fast click for mobile browsers\n\n    new $.MouseTracker({\n      element: node,\n      clickHandler: handler,\n    }).setTracking(true);\n  },\n};\n\nexport const OsdSvgOverlay = (viewer) => {\n  return new Overlay(viewer);\n};\n","import { AnnotationTarget, AnnotationNormalized } from \"@iiif/presentation-3\";\nimport { ParsedAnnotationTarget } from \"src/types/annotations\";\nimport { getLabel } from \"src/hooks/use-iiif\";\nimport { AnnotationResources } from \"src/types/annotations\";\nimport { type ViewerConfigOptions } from \"src/context/viewer-context\";\n\nexport type AnnotationTargetExtended = AnnotationTarget & {\n  selector?: any;\n  source?: string;\n  svg?: string;\n};\n\nconst parseAnnotationTarget = (target: AnnotationTargetExtended | string) => {\n  let parsedTarget: ParsedAnnotationTarget = {\n    id: typeof target === \"string\" ? target : target.source,\n  };\n\n  if (typeof target === \"string\") {\n    if (target.includes(\"#xywh=\")) {\n      const parts = target.split(\"#xywh=\");\n      if (parts && parts[1]) {\n        const [x, y, w, h] = parts[1].split(\",\").map((value) => Number(value));\n        parsedTarget = {\n          id: parts[0],\n          rect: {\n            x,\n            y,\n            w,\n            h,\n          },\n        };\n      }\n    } else if (target.includes(\"#t=\")) {\n      const parts = target.split(\"#t=\");\n      if (parts && parts[1]) {\n        parsedTarget = {\n          id: parts[0],\n          t: parts[1],\n        };\n      }\n    }\n  } else if (typeof target === \"object\") {\n    if (target.selector?.type === \"PointSelector\") {\n      parsedTarget = {\n        id: target.source,\n        point: {\n          x: target.selector.x!,\n          y: target.selector.y!,\n        },\n      };\n    } else if (target.selector?.type === \"SvgSelector\") {\n      parsedTarget = {\n        id: target.source,\n        svg: target.selector.value,\n      };\n    } else if (target.selector?.type === \"FragmentSelector\") {\n      if (\n        target.selector?.value.includes(\"xywh=\") &&\n        target.source.type == \"Canvas\" &&\n        target.source.id\n      ) {\n        const parts = target.selector?.value.split(\"xywh=\");\n        if (parts && parts[1]) {\n          const [x, y, w, h] = parts[1]\n            .split(\",\")\n            .map((value) => Number(value));\n\n          parsedTarget = {\n            id: target.source.id,\n            rect: {\n              x,\n              y,\n              w,\n              h,\n            },\n          };\n        }\n      }\n    }\n  }\n\n  return parsedTarget;\n};\n\nconst parseAnnotationsFromAnnotationResources = (\n  annotationResources: AnnotationResources,\n  vault: any,\n  configOptions: ViewerConfigOptions,\n) => {\n  const annotations: Array<AnnotationNormalized> = [];\n  annotationResources\n    .filter((annotationResource) => {\n      if (annotationResource.label) {\n        const label = getLabel(annotationResource.label);\n        if (Array.isArray(label)) {\n          return !label.some((value) =>\n            configOptions.ignoreAnnotationOverlaysLabels?.includes(value),\n          );\n        }\n      }\n\n      return true;\n    })\n    .forEach((annotationResource) => {\n      annotationResource?.items?.forEach((item) => {\n        const annotation = vault.get(item.id);\n        annotations.push(annotation as unknown as AnnotationNormalized);\n      });\n    });\n\n  return annotations;\n};\n\nexport { parseAnnotationTarget, parseAnnotationsFromAnnotationResources };\n","import {\n  Canvas,\n  CollectionNormalized,\n  IIIFExternalWebResource,\n  ImageService,\n  ManifestNormalized,\n  Service,\n} from \"@iiif/presentation-3\";\nimport { decodeContentState } from \"@iiif/vault-helpers\";\n\nexport const getCanvasResource = (canvas: Canvas) => {\n  if (canvas?.items) {\n    const annotationPage = canvas?.items[0];\n    if (annotationPage?.items) {\n      const resource = annotationPage?.items[0].body as IIIFExternalWebResource;\n      if (resource?.hasOwnProperty(\"id\")) {\n        return resource.id as string;\n      }\n    }\n  }\n};\n\nexport const getInfoResponse = (id: string) =>\n  fetch(`${id.replace(/\\/$/, \"\")}/info.json`)\n    .then((response) => response.json())\n    .then((json) => json)\n    .catch((error: any) => {\n      console.error(\n        `The IIIF tilesource ${id.replace(\n          /\\/$/,\n          \"\",\n        )}/info.json failed to load: ${error}`,\n      );\n    });\n\nexport const getImageServiceURI = (service: Service[] | undefined) => {\n  let imageService: ImageService;\n  let imageServiceURI: string | undefined;\n\n  if (Array.isArray(service)) {\n    imageService = service[0] as ImageService;\n    if (imageService) {\n      let id: string | undefined;\n      \"@id\" in imageService\n        ? (id = imageService[\"@id\"])\n        : (id = imageService.id);\n\n      imageServiceURI = id;\n    }\n  }\n\n  return imageServiceURI;\n};\n\nconst parseIiifContent = (iiifContent: string) => {\n  let resourceId;\n  let active;\n  if (isURL(iiifContent)) {\n    resourceId = iiifContent;\n    active = {};\n  } else {\n    const json = JSON.parse(decodeContentState(iiifContent));\n    switch (json?.type) {\n      // https://iiif.io/api/content-state/1.0/#51-a-region-of-a-canvas-in-a-manifest\n      // https://iiif.io/api/content-state/1.0/#52-start-playing-at-a-point-in-a-recording\n      // https://iiif.io/api/content-state/1.0/#53-multiple-targets-for-a-comparison-view\n      // https://iiif.io/api/content-state/1.0/#54-search-results\n      case \"SpecificResource\":\n      case \"Range\":\n      case \"Annotation\":\n        resourceId = json?.target.partOf[0].id;\n        active = {\n          manifest: resourceId,\n          canvas: json?.target.id,\n        };\n        break;\n      case \"Canvas\":\n        resourceId = json?.partOf[0].id;\n        active = {\n          manifest: resourceId,\n          canvas: json?.id,\n        };\n        break;\n      case \"Manifest\":\n        resourceId = json?.id;\n        active = {\n          collection: json?.partOf[0]?.id,\n          manifest: json?.id,\n        };\n        break;\n      case \"Collection\":\n        resourceId = json?.id;\n        active = {\n          collection: resourceId,\n        };\n        break;\n    }\n  }\n  return { resourceId, active };\n};\n\nexport const decodeContentStateContainerURI = (iiifContent: string) => {\n  const { resourceId, active } = parseIiifContent(iiifContent);\n  return active.collection || active.manifest || resourceId;\n};\n\nexport const getActiveCanvas = (\n  iiifContent: string,\n  manifest: ManifestNormalized,\n) => {\n  const canvases = manifest.items.map((item) => item.id);\n  const { active } = parseIiifContent(iiifContent);\n  const canvas = active.canvas;\n  return canvases.includes(canvas) ? canvas : canvases[0];\n};\n\nexport const getActiveManifest = (\n  iiifContent: string,\n  collection: CollectionNormalized,\n) => {\n  const { active } = parseIiifContent(iiifContent);\n  const manifest = active.manifest;\n  const manifests = collection.items\n    .filter((item) => item.type === \"Manifest\")\n    .map((manifest) => manifest.id);\n  if (manifests.length == 0) return null;\n  return manifests.includes(manifest) ? manifest : manifests[0];\n};\n\nconst isURL = (url: string) => {\n  try {\n    new URL(url);\n  } catch {\n    return false;\n  }\n  return true;\n};\n","export enum OpenSeadragonImageTypes {\n  TiledImage = \"tiledImage\",\n  SimpleImage = \"simpleImage\",\n}\n","import {\n  Annotation,\n  AnnotationNormalized,\n  IIIFExternalWebResource,\n  type CanvasNormalized,\n} from \"@iiif/presentation-3\";\nimport OpenSeadragon from \"openseadragon\";\nimport { type OverlayOptions } from \"src/context/viewer-context\";\nimport { OsdSvgOverlay } from \"src/lib/openseadragon-svg\";\nimport { parseAnnotationTarget } from \"src/lib/annotation-helpers\";\n\nimport { ParsedAnnotationTarget } from \"src/types/annotations\";\nimport { getImageServiceURI } from \"src/lib/iiif\";\nimport { OpenSeadragonImageTypes } from \"src/types/open-seadragon\";\n\nexport function addOverlaysToViewer(\n  viewer: OpenSeadragon.Viewer,\n  canvas: CanvasNormalized,\n  configOptions: OverlayOptions,\n  annotations: Annotation[] | AnnotationNormalized[],\n  overlaySelector: string,\n): void {\n  if (!viewer) return;\n\n  const scale = 1 / canvas.width;\n\n  annotations.forEach((annotation) => {\n    if (!annotation.target) return;\n\n    const parsedAnnotationTarget = parseAnnotationTarget(annotation.target);\n    const { point, rect, svg } = parsedAnnotationTarget;\n\n    if (rect) {\n      const { x, y, w, h } = rect;\n      addRectangularOverlay(\n        viewer,\n        x * scale,\n        y * scale,\n        w * scale,\n        h * scale,\n        configOptions,\n        overlaySelector,\n      );\n    }\n\n    if (point) {\n      const { x, y } = point;\n      const svg = `\n        <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle cx=\"${x}\" cy=\"${y}\" r=\"20\" />\n        </svg>\n      `;\n\n      addSvgOverlay(viewer, svg, configOptions, scale, overlaySelector);\n    }\n\n    if (svg) {\n      addSvgOverlay(viewer, svg, configOptions, scale, overlaySelector);\n    }\n  });\n}\n\nexport function createOpenSeadragonRect(\n  canvas: CanvasNormalized,\n  parsedAnnotationTarget: ParsedAnnotationTarget,\n  zoomLevel: number,\n) {\n  let x,\n    y,\n    w = 40,\n    h = 40;\n\n  if (parsedAnnotationTarget.rect) {\n    x = parsedAnnotationTarget.rect.x;\n    y = parsedAnnotationTarget.rect.y;\n    w = parsedAnnotationTarget.rect.w;\n    h = parsedAnnotationTarget.rect.h;\n  }\n\n  if (parsedAnnotationTarget.point) {\n    x = parsedAnnotationTarget.point.x;\n    y = parsedAnnotationTarget.point.y;\n  }\n\n  // TODO: How to handle SVG where no rect or point exists?\n  // @ts-ignore\n  if (parseAnnotationTarget.svg) {\n  }\n\n  const scale = 1 / canvas.width;\n  const rect = new OpenSeadragon.Rect(\n    x * scale - ((w * scale) / 2) * (zoomLevel - 1),\n    y * scale - ((h * scale) / 2) * (zoomLevel - 1),\n    w * scale * zoomLevel,\n    h * scale * zoomLevel,\n  );\n\n  return rect;\n}\n\n/**\n * Add a rectangular overlay to an OpenSeadragon viewer\n */\nfunction addRectangularOverlay(\n  viewer: OpenSeadragon.Viewer,\n  x: number,\n  y: number,\n  w: number,\n  h: number,\n  configOptions: OverlayOptions,\n  overlaySelector: string,\n): void {\n  const rect = new OpenSeadragon.Rect(x, y, w, h);\n  const div = document.createElement(\"div\");\n\n  if (configOptions) {\n    const { backgroundColor, opacity, borderType, borderColor, borderWidth } =\n      configOptions;\n\n    div.style.backgroundColor = backgroundColor as string;\n    div.style.opacity = opacity as string;\n    div.style.border = `${borderType} ${borderWidth} ${borderColor}`;\n    div.className = overlaySelector;\n  }\n\n  viewer.addOverlay(div, rect);\n}\n\nfunction convertSVGStringToHTML(svgString) {\n  if (!svgString) return null;\n  const template = document.createElement(\"template\");\n  template.innerHTML = svgString.trim();\n  const result = template.content.children;\n\n  return result[0];\n}\n\nexport function addSvgOverlay(\n  viewer: any,\n  svgString: string,\n  configOptions: OverlayOptions,\n  scale: number,\n  overlaySelector: string,\n) {\n  const svgEl = convertSVGStringToHTML(svgString);\n  if (svgEl) {\n    for (const child of svgEl.children) {\n      svg_processChild(viewer, child, configOptions, scale, overlaySelector);\n    }\n  }\n}\n\nfunction svg_processChild(\n  viewer: any,\n  child: ChildNode,\n  configOptions: OverlayOptions,\n  scale: number,\n  overlaySelector: string,\n) {\n  if (child.nodeName === \"#text\") {\n    svg_handleTextNode(child);\n  } else {\n    const newElement = svg_handleElementNode(child, configOptions, scale);\n    const overlay = OsdSvgOverlay(viewer);\n    overlay.node().append(newElement);\n    overlay._svg?.setAttribute(\"class\", overlaySelector);\n\n    // BUG: svg with children elements aren't formated correctly.\n    child.childNodes.forEach((child) => {\n      svg_processChild(viewer, child, configOptions, scale, overlaySelector);\n    });\n  }\n}\n\nexport function svg_handleElementNode(\n  child: any,\n  configOptions: OverlayOptions,\n  scale: number,\n) {\n  let hasStrokeColor = false;\n  let hasStrokeWidth = false;\n  let hasFillColor = false;\n  let hasFillOpacity = false;\n\n  const newElement = document.createElementNS(\n    \"http://www.w3.org/2000/svg\",\n    child.nodeName,\n  );\n\n  if (child.attributes.length > 0) {\n    for (let index = 0; index < child.attributes.length; index++) {\n      const element = child.attributes[index];\n      switch (element.name) {\n        case \"fill\":\n          hasFillColor = true;\n          break;\n        case \"stroke\":\n          hasStrokeColor = true;\n          break;\n        case \"stroke-width\":\n          hasStrokeWidth = true;\n          break;\n        case \"fill-opacity\":\n          hasFillOpacity = true;\n          break;\n      }\n      newElement.setAttribute(element.name, element.textContent);\n    }\n  }\n\n  if (!hasStrokeColor) {\n    newElement.style.stroke = configOptions?.borderColor as string;\n  }\n  if (!hasStrokeWidth) {\n    newElement.style.strokeWidth = configOptions?.borderWidth as string;\n  }\n  if (!hasFillColor) {\n    newElement.style.fill = configOptions?.backgroundColor as string;\n  }\n  if (!hasFillOpacity) {\n    newElement.style.fillOpacity = configOptions?.opacity as string;\n  }\n  newElement.setAttribute(\"transform\", `scale(${scale})`);\n\n  return newElement;\n}\n\nfunction svg_handleTextNode(child: ChildNode) {\n  if (!child.textContent) {\n    return;\n  }\n  if (child.textContent.includes(\"\\n\")) {\n    return;\n  }\n  console.log(\n    \"nodeName:\",\n    child.nodeName,\n    \", textContent:\",\n    child.textContent,\n    \", childNodes.length\",\n    child.childNodes.length,\n  );\n}\n\nexport const parseImageBody = (body: IIIFExternalWebResource) => {\n  const hasImageService =\n    Array.isArray(body?.service) && body?.service.length > 0;\n\n  const uri = hasImageService ? getImageServiceURI(body?.service) : body?.id;\n  const imageType: OpenSeadragonImageTypes = hasImageService\n    ? OpenSeadragonImageTypes.TiledImage\n    : OpenSeadragonImageTypes.SimpleImage;\n\n  return {\n    uri,\n    imageType,\n  };\n};\n\nexport const parseSrc = (src: string, isTiledImage: boolean) => {\n  const imageType = isTiledImage\n    ? OpenSeadragonImageTypes.TiledImage\n    : OpenSeadragonImageTypes.SimpleImage;\n\n  return {\n    uri: src,\n    imageType,\n  };\n};\nexport function removeOverlaysFromViewer(\n  viewer: OpenSeadragon.Viewer,\n  overlaySelector: string,\n) {\n  if (!viewer) return;\n\n  if (!overlaySelector.startsWith(\".\")) {\n    overlaySelector = \".\" + overlaySelector;\n  }\n  const elements = document.querySelectorAll(overlaySelector);\n  if (elements) {\n    elements.forEach((element) => viewer.removeOverlay(element));\n  }\n}\n\nexport function panToTarget(openSeadragonViewer, zoomLevel, target, canvas) {\n  const parsedAnnotationTarget = parseAnnotationTarget(target);\n\n  const { point, rect, svg } = parsedAnnotationTarget;\n\n  if (point || rect || svg) {\n    const rect = createOpenSeadragonRect(\n      canvas,\n      parsedAnnotationTarget,\n      zoomLevel,\n    );\n    openSeadragonViewer?.viewport.fitBounds(rect);\n  }\n}\n"],"names":["$","OpenSeadragon","svgNS","Overlay","viewer","self","p","zoom","rotation","flipped","containerSizeX","scaleX","scaleY","node","handler","OsdSvgOverlay","parseAnnotationTarget","target","parsedTarget","parts","x","y","w","h","value","_a","_b","_c","_d","_e","getImageServiceURI","service","imageService","imageServiceURI","id","OpenSeadragonImageTypes","addOverlaysToViewer","canvas","configOptions","annotations","overlaySelector","scale","annotation","parsedAnnotationTarget","point","rect","svg","addRectangularOverlay","addSvgOverlay","createOpenSeadragonRect","zoomLevel","div","backgroundColor","opacity","borderType","borderColor","borderWidth","convertSVGStringToHTML","svgString","template","svgEl","child","svg_processChild","svg_handleTextNode","newElement","svg_handleElementNode","overlay","hasStrokeColor","hasStrokeWidth","hasFillColor","hasFillOpacity","index","element","parseImageBody","body","hasImageService","uri","imageType","parseSrc","src","isTiledImage","removeOverlaysFromViewer","elements","panToTarget","openSeadragonViewer"],"mappings":"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"}